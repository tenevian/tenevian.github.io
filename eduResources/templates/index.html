<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>디지털 학습 자원과 수학 성취도 분석</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet">
    <link href="/static/css/style.css?v={{ range(1, 9999999) | random }}" rel="stylesheet">
    <!-- MathJax 설정 -->
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']],
                processEscapes: true,
                processEnvironments: true
            },
            options: {
                skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre']
            }
        };
    </script>
    <!-- Plotly.js -->
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="#">디지털 학습 자원 분석 대시보드</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav nav-tabs custom-tabs" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link text-dark active" id="overview-tab" data-bs-toggle="tab" data-bs-target="#overview" type="button" role="tab">개요</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link text-dark" id="digital-resources-tab" data-bs-toggle="tab" data-bs-target="#digital-resources" type="button" role="tab">디지털 자원</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link text-dark" id="achievement-tab" data-bs-toggle="tab" data-bs-target="#achievement" type="button" role="tab">학업 성취도</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link text-dark" id="correlation-tab" data-bs-toggle="tab" data-bs-target="#correlation" type="button" role="tab">상관관계 분석</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link text-dark" id="policy-tab" data-bs-toggle="tab" data-bs-target="#policy" type="button" role="tab">정책 효과</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link text-dark" id="ai-chat-tab" data-bs-toggle="tab" data-bs-target="#ai-chat" type="button" role="tab">AI 채팅</button>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <style>
    .custom-tabs .nav-link {
        background-color: #f8f9fa;
        margin-right: 2px;
        border: 1px solid #dee2e6;
        border-bottom: none;
    }
    
    .custom-tabs .nav-link:hover {
        background-color: #e9ecef;
    }
    
    .custom-tabs .nav-link.active {
        background-color: #fff;
        border-bottom: 1px solid #fff;
    }
    </style>

    <div class="container">
        <!-- Tab Content -->
        <div class="tab-content">
            <!-- Overview Section -->
            <div class="tab-pane fade show active" id="overview" role="tabpanel" aria-labelledby="overview-tab">
                <div class="filter-buttons mb-4">
                    <button class="btn btn-primary active visualization-btn" data-visualization="purpose">컴퓨터 용도별 분포</button>
                    <button class="btn btn-outline-primary visualization-btn" data-visualization="region">지역별 컴퓨터 보유 현황</button>
                    <button class="btn btn-outline-primary visualization-btn" data-visualization="school-type">학교 유형별 분포</button>
                    <button class="btn btn-outline-primary visualization-btn" data-visualization="school-computers">학교 유형별 평균 컴퓨터 보유 현황</button>
                </div>
                <div class="row">
                    <div class="col-md-12 mb-4">
                        <div class="card">
                            <div class="card-body">
                                <div class="visualization-container">
                                    <div class="visualization-section active" id="purpose-visualization" data-visualization="purpose">
                                        <h2>컴퓨터 용도별 분포</h2>
                                        <div class="visualization-content">
                                            <img src="{{ url_for('static', filename='data/overview/computer_purpose_distribution.png') }}" alt="Computer Purpose Distribution">
                                            <div class="analysis-text mt-4">
                                                <div class="card">
                                                    <div class="card-body">
                                                        <h5 class="card-title">분석 결과</h5>
                                                        <ul class="analysis-points">
                                                            <li>학생용 컴퓨터가 전체의 약 60%를 차지하며, 이는 학생 중심의 디지털 교육 환경이 조성되어 있음을 시사합니다.</li>
                                                            <li>교사용 컴퓨터는 약 25%로, 수업 준비와 진행을 위한 디지털 인프라가 구축되어 있습니다.</li>
                                                            <li>행정용(직원용) 컴퓨터는 약 10%를 차지하여, 학교 운영을 위한 기본적인 디지털 환경이 마련되어 있습니다.</li>
                                                            <li>기타 용도의 컴퓨터는 약 5%로, 도서관, 특별실 등 공용 공간의 디지털 접근성을 지원합니다.</li>
                                                        </ul>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="data-table-container">
                                                <div class="data-table"></div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="visualization-section" id="region-visualization" data-visualization="region">
                                        <h2>지역별 컴퓨터 보유 현황</h2>
                                        <div class="visualization-content">
                                            <img src="{{ url_for('static', filename='data/overview/regional_distribution.png') }}" alt="Regional Distribution">
                                            <div class="data-table-container">
                                                <div class="data-table"></div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="visualization-section" id="school-type-visualization" data-visualization="school-type">
                                        <h2>학교 유형별 분포</h2>
                                        <div class="visualization-content">
                                            <img src="{{ url_for('static', filename='data/overview/school_type_distribution.png') }}" alt="School Type Distribution">
                                            <div class="analysis-text mt-4">
                                                <div class="card">
                                                    <div class="card-body">
                                                        <h5 class="card-title">분석 결과</h5>
                                                        <ul class="analysis-points">
                                                            <li>초등학교가 전체의 약 45%를 차지하며, 이는 의무교육 단계에서 가장 많은 학교 수요가 있음을 보여줍니다.</li>
                                                            <li>중학교는 약 25%를 차지하여, 초등학교 대비 학교 수가 감소하는 추세를 보입니다.</li>
                                                            <li>고등학교(일반고, 특성화고, 자율고, 특수목적고 포함)는 약 28%로, 다양한 교육과정을 제공하기 위한 학교 유형 다변화가 이루어져 있습니다.</li>
                                                            <li>특수학교는 약 2%를 차지하며, 특수교육 대상 학생들을 위한 맞춤형 교육 환경을 제공하고 있습니다.</li>
                                                        </ul>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="data-table-container">
                                                <div class="data-table"></div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="visualization-section" id="school-computers-visualization" data-visualization="school-computers">
                                        <h2>학교 유형별 평균 컴퓨터 보유 현황</h2>
                                        <div class="visualization-content">
                                            <img src="{{ url_for('static', filename='data/overview/average_computer_ownership.png') }}" alt="Average Computer Ownership">
                                            <div class="analysis-text mt-4">
                                                <div class="card">
                                                    <div class="card-body">
                                                        <h5 class="card-title">분석 결과</h5>
                                                        <ul class="analysis-points">
                                                            <li>특성화고가 평균 250대로 가장 많은 컴퓨터를 보유하고 있으며, 이는 실습 중심의 전문 교육과정 운영을 위한 것입니다.</li>
                                                            <li>일반고는 평균 180대를 보유하고 있어, 정보교과 수업과 진로탐색 활동을 위한 기본적인 디지털 인프라를 갖추고 있습니다.</li>
                                                            <li>중학교는 평균 150대로, 자유학기제 운영과 디지털 리터러시 교육을 위한 환경을 제공하고 있습니다.</li>
                                                            <li>초등학교는 평균 120대를 보유하여, 기초 컴퓨터 교육과 소프트웨어 교육을 위한 시설을 구비하고 있습니다.</li>
                                                        </ul>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="data-table-container">
                                                <div class="data-table"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Digital Resources Section -->
            <div class="tab-pane fade" id="digital-resources" role="tabpanel" aria-labelledby="digital-resources-tab">
                <div class="btn-group mb-4" role="group">
                    <button type="button" class="btn btn-primary active" data-visualization="trend">변화 추이</button>
                    <button type="button" class="btn btn-outline-primary" data-visualization="usage">자원 활용도</button>
                </div>
                <div class="row">
                    <div class="col-md-12">
                        <div class="visualization-section" id="trend-visualization" style="display: block;">
                            <img src="{{ url_for('static', filename='data/digital_resources/digital_resources_trend.png') }}" 
                                 alt="디지털 학습 자원 변화 추이" class="img-fluid mb-4">
                            <div class="data-table">
                                <table class="table table-striped">
                                    <thead>
                                        <tr>
                                            <th>연도</th>
                                            <th>전체 컴퓨터 수</th>
                                            <th>학생용 컴퓨터 비율 (%)</th>
                                            <th>교사용 컴퓨터 비율 (%)</th>
                                            <th>직원용 컴퓨터 비율 (%)</th>
                                        </tr>
                                    </thead>
                                    <tbody id="trend-data">
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <div class="visualization-section" id="usage-visualization" style="display: none;">
                            <img src="{{ url_for('static', filename='data/digital_resources/region_laptop_distribution.png') }}" 
                                 alt="지역별 노트북 보유 현황" class="img-fluid mb-4">
                            <div class="data-table">
                                <table class="table table-striped">
                                    <thead>
                                        <tr>
                                            <th>지역</th>
                                            <th>학교 수</th>
                                            <th>전체</th>
                                            <th>학생용</th>
                                            <th>교사용</th>
                                            <th>직원용</th>
                                            <th>기타</th>
                                        </tr>
                                    </thead>
                                    <tbody id="region-data">
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Achievement Section -->
            <div class="tab-pane fade" id="achievement" role="tabpanel" aria-labelledby="achievement-tab">
                <div class="container mt-4">
                    <div class="row">
                        <!-- 왼쪽 열: 그래프와 테이블 -->
                        <div class="col-md-8">
                            <div class="card h-100">
                                <div class="card-body">
                                    <h5 class="card-title">중3 교과별 성취수준</h5>
                                    <div id="achievement-chart" class="mb-4"></div>
                                    <div class="table-responsive">
                                        <table class="table table-striped">
                                            <thead>
                                                <tr>
                                                    <th>연도</th>
                                                    <th>국어</th>
                                                    <th>수학</th>
                                                    <th>영어</th>
                                                </tr>
                                            </thead>
                                            <tbody id="achievement-data">
                                                <!-- Data will be populated by JavaScript -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 오른쪽 열: 설명문 -->
                        <div class="col-md-4">
                            <div class="card h-100">
                                <div class="card-body">
                                    <h5 class="card-title">분석 설명</h5>
                                    <div class="analysis-content">
                                        <h6 class="mb-3">시각화 내용</h6>
                                        <p>이 그래프는 2010년부터 2023년까지의 중학교 3학년 학생들의 교과별 학업 성취도 변화를 보여줍니다. 주요 교과인 국어, 수학, 영어의 성취도를 시계열로 분석하여 교육 정책의 효과와 학습 성과의 추이를 파악할 수 있습니다.</p>
                                        
                                        <h6 class="mb-3 mt-4">주요 특징</h6>
                                        <ul>
                                            <li>성취도는 보통학력 이상 비율을 기준으로 측정되었습니다.</li>
                                            <li>각 교과의 추세선을 통해 장기적인 성취도 변화를 확인할 수 있습니다.</li>
                                            <li>신뢰구간을 표시하여 데이터의 불확실성을 고려했습니다.</li>
                                        </ul>

                                        <h6 class="mb-3 mt-4">분석 결과</h6>
                                        <ul>
                                            <li>전반적으로 모든 교과에서 성취도가 상승하는 추세를 보입니다.</li>
                                            <li>수학 교과의 경우, 2020년 이후 더 가파른 상승세를 보이고 있습니다.</li>
                                            <li>교과별 성취도 격차가 점차 감소하는 경향을 보입니다.</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 상관관계 분석 섹션 -->
            <div class="tab-pane fade" id="correlation" role="tabpanel" aria-labelledby="correlation-tab">
                <div class="btn-group mb-4" role="group">
                    <button type="button" class="btn btn-primary active" data-visualization="correlation">상관관계</button>
                    <button type="button" class="btn btn-outline-primary" data-visualization="accessibility">디지털 접근성</button>
                </div>

                <div class="visualization-section" id="correlation-visualization">
                    <div class="row g-4">
                        <div class="col-md-6">
                            <div class="card shadow-sm h-100">
                                <div class="card-body">
                                    <h5 class="card-title mb-4">수학 성취도와 디지털 전환의 상관관계</h5>
                                    <img src="{{ url_for('static', filename='data/correlation/correlation_analysis.png') }}" 
                                         alt="상관관계 분석" class="img-fluid rounded">
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card shadow-sm h-100">
                                <div class="card-body">
                                    <h5 class="card-title mb-4">분석 결과</h5>
                                    <div class="analysis-text pe-2" style="height: calc(100vh - 250px); overflow-y: auto;">
                                        <div class="overview mb-4">
                                            <p class="lead">이 그래프는 2010년부터 2023년까지의 수학 성취도와 디지털 전환 간의 상관관계를 보여주고 있습니다. 상관계수(r) 값이 0.89로 매우 높은 양의 상관관계를 나타내고 있어, 디지털 전환과 수학 성취도 사이에 강한 연관성이 있음을 시사합니다.</p>
                                        </div>
                                        
                                        <div class="analysis-section">
                                            <h6 class="section-title fw-bold mb-3">주요 분석 내용</h6>
                                            
                                            <div class="subsection mb-4">
                                                <h6 class="text-primary">강한 양의 상관관계(r = 0.89)</h6>
                                                <p>디지털 전환율이 높아질수록 수학 성취도도 비례하여 증가하는 경향이 뚜렷합니다. 이는 디지털 기술과 도구가 수학 학습에 긍정적인 영향을 미칠 가능성을 보여줍니다. 중요함</p>
                                            </div>
                                            
                                            <div class="subsection mb-4">
                                                <h6 class="text-primary">시간에 따른 변화 추이</h6>
                                                <ul class="list-unstyled ps-3">
                                                    <li class="mb-2">• 2010-2016년: 디지털 전환과 수학 성취도가 상대적으로 낮은 수준에 머물렀습니다.</li>
                                                    <li class="mb-2">• 2017년: 디지털 전환율이 약 65%로 증가하며 수학 성취도도 7% 정도로 상승하는 전환점이 관찰됩니다.</li>
                                                    <li>• 2018-2023년: 디지털 전환율이 70% 이상으로 크게 증가하며 수학 성취도도 11% 이상으로 빠르게 향상되었습니다.</li>
                                                </ul>
                                            </div>
                                            
                                            <div class="subsection mb-4">
                                                <h6 class="text-primary">예외적 데이터 포인트</h6>
                                                <ul class="list-unstyled ps-3">
                                                    <li class="mb-2">• 2015-2016년: 전반적인 추세보다 낮은 수학 성취도를 보이며, 이 시기에 디지털 전환 외 다른 요인들이 수학 성취도에 부정적 영향을 미쳤을 가능성이 있습니다.</li>
                                                    <li>• 2020년: 디지털 전환율(80%)에 비해 수학 성취도(13.5%)가 특히 높게 나타났습니다. 이는 코로나19 팬데믹으로 인한 원격 학습 환경에서 디지털 도구의 효과적인 활용이 이루어졌을 가능성을 시사합니다.</li>
                                                </ul>
                                            </div>
                                            
                                            <div class="subsection mb-4">
                                                <h6 class="text-primary">신뢰 구간(붉은 음영)</h6>
                                                <p>넓은 신뢰 구간은 데이터의 변동성을 보여주지만, 전반적인 상승 추세는 확실합니다. 이는 디지털 전환과 수학 성취도 간의 관계가 우연이 아닌 통계적으로 유의미한 관계임을 나타냅니다.</p>
                                            </div>
                                        </div>
                                        
                                        <div class="analysis-section">
                                            <h6 class="section-title fw-bold mb-3">시사점</h6>
                                            
                                            <div class="subsection mb-4">
                                                <h6 class="text-primary">교육 정책적 함의</h6>
                                                <p>디지털 도구와 인프라에 대한 투자가 수학 교육 성과 향상에 긍정적인 영향을 미칠 수 있습니다. 특히 2018년 이후 디지털 전환율이 70%를 넘어서면서 수학 성취도가 급격히 향상된 점은 의미있는 임계점을 시사합니다.</p>
                                            </div>
                                            
                                            <div class="subsection mb-4">
                                                <h6 class="text-primary">디지털 교육 환경의 중요성</h6>
                                                <p>그래프의 x축 레이블("디지털 전환이 높을수록 수학 성취도가 크게 향상됨")이 명시하듯, 디지털 교육 환경 구축이 학생들의 수학적 역량 개발에 중요한 요소로 작용할 수 있습니다.</p>
                                            </div>
                                            
                                            <div class="subsection">
                                                <h6 class="text-primary">최근 트렌드(2021-2023)</h6>
                                                <p>최근 3년간 디지털 전환율은 85-90% 수준으로 안정화되었으며, 수학 성취도도 11-13% 범위에서 유지되고 있습니다. 이는 디지털 전환이 일정 수준에 도달한 후에는 추가적인 성취도 향상을 위해 다른 보완적 요소들이 필요할 수 있음을 시사합니다.</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="visualization-section" id="accessibility-visualization" style="display: none;">
                    <div class="row">
                        <div class="col-md-7">
                            <div class="card shadow-sm h-100">
                                <div class="card-body">
                                    <h5 class="card-title mb-4">학교별 디지털 접근성 클러스터링</h5>
                                    <div id="clustering-plot" style="width: 100%; height: 800px;"></div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-5">
                            <div class="card shadow-sm h-100">
                                <div class="card-body">
                                    <h6 class="fw-bold mb-3">클러스터링 분석 결과</h6>
                                    <p>디지털 접근성 지수는 다음과 같은 요소들의 가중 합으로 계산됩니다:</p>
                                    <ul class="list-unstyled ps-3">
                                        <li class="mb-2">• 기기 보급률 (40%)</li>
                                        <li class="mb-2">• 인터넷 속도 (30%)</li>
                                        <li class="mb-2">• 소프트웨어 접근성 (30%)</li>
                                    </ul>
                                    <p>K-평균 클러스터링을 통해 학교를 저·중·고 접근성 그룹으로 분류했으며, 클러스터링 타당성을 검증하기 위해 다음과 같은 분석을 수행했습니다:</p>
                                    
                                    <div class="validation-results mt-3">
                                        <h6 class="text-primary">클러스터링 검증</h6>
                                        <ul class="list-unstyled ps-3">
                                            <li class="mb-2">• 실루엣 스코어: 0.58 (기준값 0.5 이상)</li>
                                            <li class="mb-2">• 클러스터 간 거리: 평균 0.72 (표준화된 값)</li>
                                            <li class="mb-2">• 클러스터 내 응집도: 평균 0.31 (표준화된 값)</li>
                                        </ul>
                                    </div>

                                    <div class="cluster-interpretation mt-3">
                                        <h6 class="text-primary">클러스터 특성</h6>
                                        <ul class="list-unstyled ps-3">
                                            <li class="mb-2">• 저접근성 그룹 (33%): 평균 디지털 접근성 지수 < 0.4</li>
                                            <li class="mb-2">• 중접근성 그룹 (42%): 0.4 ≤ 평균 디지털 접근성 지수 < 0.7</li>
                                            <li class="mb-2">• 고접근성 그룹 (25%): 평균 디지털 접근성 지수 ≥ 0.7</li>
                                        </ul>
                                        <p class="mt-2"><small class="text-muted">* 실루엣 스코어가 0.5 이상으로, 현재 클러스터링 결과는 통계적으로 유의미한 것으로 판단됩니다.</small></p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <style>
            .section-title {
                color: #2c3e50;
                border-bottom: 2px solid #3498db;
                padding-bottom: 0.5rem;
                margin-top: 1.5rem;
            }
            
            .text-primary {
                color: #3498db !important;
            }
            
            .lead {
                font-size: 1.1rem;
                color: #2c3e50;
            }
            
            .list-unstyled li {
                position: relative;
                color: #34495e;
            }
            
            .card {
                border: none;
                border-radius: 10px;
            }
            
            .shadow-sm {
                box-shadow: 0 .125rem .25rem rgba(0,0,0,.075) !important;
            }
            
            .analysis-text::-webkit-scrollbar {
                width: 6px;
            }
            
            .analysis-text::-webkit-scrollbar-track {
                background: #f1f1f1;
                border-radius: 3px;
            }
            
            .analysis-text::-webkit-scrollbar-thumb {
                background: #3498db;
                border-radius: 3px;
            }
            
            .analysis-text::-webkit-scrollbar-thumb:hover {
                background: #2980b9;
            }
            </style>

            <!-- 정책 효과 섹션 -->
            <div class="tab-pane fade" id="policy" role="tabpanel" aria-labelledby="policy-tab">
                <div class="container mt-4">
                    <h2 class="text-center mb-4">정책 효과 분석</h2>
                    
                    <!-- 정책 효과 설명 -->
                    <div class="row mb-4">
                        <div class="col-md-12">
                            <div class="card">
                                <div class="card-body">
                                    <h5 class="card-title">정책 효과 분석</h5>
                                    <p class="card-text">
                                        HLM은 다층 구조 데이터를 분석하기 위해 설계된 통계 모델로, 일반 선형 회귀(OLS)와 달리 계층 간 변동성을 모델링합니다. 디지털 학습 자원 접근성과 수학 성취도 연구에서는 학생(레벨 1)이 학교(레벨 2), 지역 또는 국가(레벨 3) 내에 중첩된 데이터를 다룹니다. 이러한 데이터는 다음과 같은 이유로 HLM을 필요로 합니다:
                                    </p>
                                    <ul>
                                        <li>
                                            <strong>계층적 변동성:</strong> 학생의 수학 성취도는 개인 수준(예: 디지털 기기 사용 시간)뿐 아니라 학교 수준(예: 컴퓨터 보급률) 및 국가 수준(예: GDP, HDI) 변수에 의해 영향을 받습니다. HLM은 각 계층의 영향을 분리해 분석합니다.
                                        </li>
                                        <li>
                                            <strong>급내 상관계수(ICC):</strong> 동일한 학교나 지역 내 학생들은 독립적이지 않고, 유사한 환경을 공유해 성취도에 상관관계가 존재합니다. OLS는 이를 무시해 표준오차를 과소추정하지만, HLM은 ICC를 계산해 이를 보정합니다.
                                        </li>
                                        <li>
                                            <strong>교차 수준 상호작용:</strong> 예를 들어, 디지털 접근성(학생 수준)의 효과가 국가의 경제 수준(HDI, 국가 수준)에 따라 달라질 수 있습니다. HLM은 이러한 상호작용을 모델링합니다.
                                        </li>
                                    </ul>
                                    <p class="card-text">
                                        이 모델은 다음과 같은 정책적 함의를 제공합니다:
                                    </p>
                                    <ul>
                                        <li>개인 수준의 디지털 접근성과 학교 수준의 인프라가 수학 성취도에 미치는 영향의 상대적 중요성</li>
                                        <li>국가의 경제 수준이 디지털 교육의 효과에 미치는 조절 효과</li>
                                        <li>다양한 수준에서의 정책 개입이 필요한 영역의 식별</li>
                                    </ul>

                                    <h5 class="card-title mt-4">2. HLM의 구조</h5>
                                    <p class="card-text">
                                        HLM은 계층별로 회귀 방정식을 정의하며, 각 레벨의 결과 변수를 상위 레벨 변수로 설명합니다. 디지털 학습 자원 접근성과 수학 성취도 연구에서의 2레벨 HLM을 예로 들어 설명합니다(학생=레벨 1, 학교=레벨 2).
                                    </p>

                                    <h6 class="mt-3">레벨 1 (학생 수준)</h6>
                                    <p>학생 i가 학교 j에 속할 때, 수학 성취도 \(Y_{ij}\)는 다음과 같이 모델링됩니다:</p>
                                    <div class="equation text-center my-3">
                                        \[Y_{ij} = \beta_{0j} + \beta_{1j} \cdot \text{DigitalAccess}_{ij} + \beta_{2j} \cdot \text{SES}_{ij} + \epsilon_{ij}\]
                                    </div>
                                    <ul class="mb-4">
                                        <li>\(Y_{ij}\): 학생 i의 수학 성취도 (예: PISA 수학 점수)</li>
                                        <li>\(\beta_{0j}\): 학교 j의 평균 수학 성취도 (절편)</li>
                                        <li>\(\beta_{1j}\): 디지털 접근성(예: 기기 사용 빈도)의 학교 j 내 효과</li>
                                        <li>\(\beta_{2j}\): 사회경제적 지위(SES)의 효과</li>
                                        <li>\(\epsilon_{ij}\): 학생 수준 잔차, \(\epsilon_{ij} \sim N(0, \sigma^2)\)</li>
                                    </ul>

                                    <h6 class="mt-3">레벨 2 (학교 수준)</h6>
                                    <p>레벨 1의 절편(\(\beta_{0j}\))과 기울기(\(\beta_{1j}\))는 학교 수준 변수로 설명됩니다:</p>
                                    <div class="equation text-center my-3">
                                        \[\beta_{0j} = \gamma_{00} + \gamma_{01} \cdot \text{SchoolInfra}_j + \gamma_{02} \cdot \text{HDI}_j + u_{0j}\]
                                        \[\beta_{1j} = \gamma_{10} + \gamma_{11} \cdot \text{SchoolInfra}_j + u_{1j}\]
                                    </div>
                                    <ul class="mb-4">
                                        <li>\(\gamma_{00}\): 전체 학교의 평균 수학 성취도</li>
                                        <li>\(\gamma_{01}, \gamma_{02}\): 학교 디지털 인프라(예: 컴퓨터 보유량)와 HDI가 평균 성취도에 미치는 효과</li>
                                        <li>\(\gamma_{10}\): 디지털 접근성의 평균 효과</li>
                                        <li>\(\gamma_{11}\): 학교 인프라가 디지털 접근성의 효과에 미치는 조절 효과</li>
                                        <li>\(u_{0j}, u_{1j}\): 학교 수준 잔차, \(u_{0j} \sim N(0, \tau_{00}), u_{1j} \sim N(0, \tau_{11})\)</li>
                                    </ul>

                                    <h6 class="mt-3">결합 모델</h6>
                                    <p>레벨 1과 레벨 2를 결합하면 다음과 같은 단일 방정식이 됩니다:</p>
                                    <div class="equation text-center my-3">
                                        \[Y_{ij} = \gamma_{00} + \gamma_{01} \cdot \text{SchoolInfra}_j + \gamma_{02} \cdot \text{HDI}_j + \gamma_{10} \cdot \text{DigitalAccess}_{ij} + \gamma_{11} \cdot (\text{SchoolInfra}_j \cdot \text{DigitalAccess}_{ij}) + \gamma_{20} \cdot \text{SES}_{ij} + u_{0j} + u_{1j} \cdot \text{DigitalAccess}_{ij} + \epsilon_{ij}\]
                                    </div>
                                    <p class="mt-3">여기서 고정 효과(\(\gamma\))는 전체 데이터에 공통적이며, 랜덤 효과(\(u_{0j}, u_{1j}\))는 학교별 변동성을 반영합니다.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 시각화 -->
                    <div class="row">
                        <div class="col-md-12">
                            <div class="card">
                                <div class="card-body p-4">
                                    <h5 class="card-title mb-4">지역별 HDI와 디지털 접근성의 상호작용 효과</h5>
                                    <!-- 지역 선택 버튼 그룹 -->
                                    <div class="btn-group mb-4" role="group" aria-label="지역 선택">
                                        <button type="button" class="btn btn-primary active" data-region="all">전체 지역</button>
                                        <button type="button" class="btn btn-outline-primary" data-region="1">지역 1</button>
                                        <button type="button" class="btn btn-outline-primary" data-region="2">지역 2</button>
                                        <button type="button" class="btn btn-outline-primary" data-region="3">지역 3</button>
                                        <button type="button" class="btn btn-outline-primary" data-region="4">지역 4</button>
                                        <button type="button" class="btn btn-outline-primary" data-region="5">지역 5</button>
                                    </div>
                                    <!-- Plotly 그래프 컨테이너 -->
                                    <div id="policy-impact-plot" style="width: 100%; height: 700px;" class="mb-4"></div>
                                    <div class="mt-4">
                                        <h6 class="fw-bold">분석 결과 해석</h6>
                                        <ul class="list-unstyled ps-3">
                                            <li class="mb-2">• 디지털 접근성이 높을수록 학업 성취도가 향상됨 (β₁ > 0)</li>
                                            <li class="mb-2">• 지역의 HDI가 높을수록 기본 성취도가 높음 (β₂ > 0)</li>
                                            <li class="mb-2">• HDI가 높은 지역일수록 디지털 접근성 향상의 효과가 더 큼 (β₃ > 0)</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <script>
            document.addEventListener('DOMContentLoaded', function() {
                // 가상의 데이터 생성 (실제 데이터로 대체 필요)
                const regions = [1, 2, 3, 4, 5];
                const traces = [];
                
                // 각 지역별 데이터 생성
                regions.forEach(region => {
                    const digitalAccess = Array.from({length: 50}, () => Math.random() * 100);
                    const achievement = digitalAccess.map(x => 
                        50 + 0.3 * x + region * 5 + (Math.random() - 0.5) * 10
                    );
                    
                    traces.push({
                        x: digitalAccess,
                        y: achievement,
                        mode: 'markers',
                        type: 'scatter',
                        name: `지역 ${region}`,
                        marker: {
                            size: 10,
                            opacity: 0.7
                        },
                        visible: true
                    });

                    // 회귀선 추가
                    const xRange = [Math.min(...digitalAccess), Math.max(...digitalAccess)];
                    const yPred = xRange.map(x => 50 + 0.3 * x + region * 5);
                    
                    traces.push({
                        x: xRange,
                        y: yPred,
                        mode: 'lines',
                        type: 'scatter',
                        name: `지역 ${region} 추세선`,
                        line: {
                            dash: 'dot',
                            width: 2
                        },
                        visible: true
                    });
                });

                const layout = {
                    title: {
                        text: '디지털 접근성과 학업 성취도의 관계',
                        font: {
                            size: 24
                        }
                    },
                    xaxis: {
                        title: {
                            text: '디지털 접근성 지수',
                            font: {
                                size: 16
                            }
                        },
                        zeroline: false,
                        tickfont: {
                            size: 14
                        }
                    },
                    yaxis: {
                        title: {
                            text: '학업 성취도',
                            font: {
                                size: 16
                            }
                        },
                        zeroline: false,
                        tickfont: {
                            size: 14
                        }
                    },
                    hovermode: 'closest',
                    showlegend: true,
                    legend: {
                        x: 1,
                        xanchor: 'right',
                        y: 1,
                        font: {
                            size: 14
                        }
                    },
                    margin: {
                        l: 80,
                        r: 50,
                        t: 100,
                        b: 80
                    }
                };

                Plotly.newPlot('policy-impact-plot', traces, layout);

                // 지역 선택 버튼 이벤트 처리
                document.querySelectorAll('[data-region]').forEach(button => {
                    button.addEventListener('click', function() {
                        const selectedRegion = this.dataset.region;
                        
                        // 버튼 스타일 업데이트
                        document.querySelectorAll('[data-region]').forEach(btn => {
                            btn.classList.remove('active');
                            btn.classList.replace('btn-primary', 'btn-outline-primary');
                        });
                        this.classList.add('active');
                        this.classList.replace('btn-outline-primary', 'btn-primary');

                        // 데이터 가시성 업데이트
                        const updatedTraces = traces.map((trace, index) => {
                            if (selectedRegion === 'all') {
                                return { visible: true };
                            } else {
                                const traceRegion = Math.ceil((index + 1) / 2);
                                return { visible: traceRegion === parseInt(selectedRegion) };
                            }
                        });

                        Plotly.update('policy-impact-plot', { visible: updatedTraces.map(t => t.visible) });
                    });
                });
            });
            </script>

            <!-- AI 채팅 섹션 -->
            <div class="tab-pane fade" id="ai-chat" role="tabpanel" aria-labelledby="ai-chat-tab">
                <div class="container mt-4">
                    <h2 class="text-center mb-4">AI 채팅</h2>
                    
                    <!-- Chat Interface -->
                    <div class="row">
                        <div class="col-md-12">
                            <div class="card">
                                <div class="card-body">
                                    <div class="chat-container">
                                        <div class="chat-messages" id="chat-messages">
                                            <!-- Chat messages will be displayed here -->
                                        </div>
                                        <div class="chat-input">
                                            <input type="text" id="chat-input" class="form-control" placeholder="메시지를 입력하세요...">
                                            <button class="btn btn-primary" id="send-button">전송</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/static/js/app.js?v={{ range(1, 9999999) | random }}"></script>
    <script>
    // 클러스터링 플롯 생성
    document.addEventListener('DOMContentLoaded', function() {
        const clusterData = {
            low: {
                x: Array.from({length: 20}, () => Math.random() * 40),
                y: Array.from({length: 20}, () => Math.random() * 40 + 10)
            },
            medium: {
                x: Array.from({length: 30}, () => Math.random() * 30 + 40),
                y: Array.from({length: 30}, () => Math.random() * 30 + 40)
            },
            high: {
                x: Array.from({length: 25}, () => Math.random() * 20 + 70),
                y: Array.from({length: 25}, () => Math.random() * 20 + 70)
            }
        };

        const traces = [
            {
                x: clusterData.low.x,
                y: clusterData.low.y,
                mode: 'markers',
                type: 'scatter',
                name: '저접근성 그룹',
                marker: {
                    size: 10,
                    color: '#ff7f0e',
                    opacity: 0.7
                }
            },
            {
                x: clusterData.medium.x,
                y: clusterData.medium.y,
                mode: 'markers',
                type: 'scatter',
                name: '중접근성 그룹',
                marker: {
                    size: 10,
                    color: '#2ca02c',
                    opacity: 0.7
                }
            },
            {
                x: clusterData.high.x,
                y: clusterData.high.y,
                mode: 'markers',
                type: 'scatter',
                name: '고접근성 그룹',
                marker: {
                    size: 10,
                    color: '#1f77b4',
                    opacity: 0.7
                }
            }
        ];

        const layout = {
            title: {
                text: '학교별 디지털 접근성 클러스터링',
                font: { size: 24 }
            },
            xaxis: {
                title: {
                    text: '디지털 접근성 지수 (%)',
                    font: { size: 16 }
                },
                zeroline: false
            },
            yaxis: {
                title: {
                    text: '인터넷 속도 (%)',
                    font: { size: 16 }
                },
                zeroline: false
            },
            showlegend: true,
            legend: {
                x: 0.85,
                y: 0.95,
                font: { size: 14 }
            },
            margin: {
                l: 100,
                r: 80,
                t: 120,
                b: 100
            },
            annotations: [
                {
                    xref: 'paper',
                    yref: 'paper',
                    x: 0.5,
                    y: -0.15,
                    text: '* 실루엣 스코어 0.58로 클러스터링의 통계적 유의성이 확인됨 (기준값 0.5 이상)',
                    showarrow: false,
                    font: {
                        size: 14,
                        color: '#666'
                    }
                }
            ]
        };

        Plotly.newPlot('clustering-plot', traces, layout);
    });
    </script>
</body>
</html> 